NOTE(dkorolev): This commit is ChatGPT-generated!

And here is how the output of the autogenerated HTML from this directory looks like!

![image](https://github.com/user-attachments/assets/460aab53-7eb4-40aa-9f20-112a23f77de4)

System flor diagram (ChatGPT):

```mermaid
sequenceDiagram
  participant User
  participant AxumAPI
  participant RedbWorker
  participant KrakenWS
  participant RedisPub

  loop WebSocket Loop
    KrakenWS->>Main Task: Trade Message JSON
    Main Task->>RedbWorker: CheckIdExistsRequest
    RedbWorker-->>Main Task: Exists?
    alt Not Exists
      Main Task->>RedbWorker: GetNextTradeCounterRequest
      RedbWorker-->>Main Task: next_index
      Main Task->>RedbWorker: StoreIdWithIndexRequest
      Main Task->>RedbWorker: StoreTradeBatchRequest(trade, index)
      Main Task->>RedisPub: PUBLISH "trades" â† Trade JSON
    else Exists
      Main Task->>Main Task: Skip
    end
  end

  User->>AxumAPI: GET /trades/count
  AxumAPI->>RedbWorker: GetTotalTradesCountRequest
  RedbWorker-->>AxumAPI: count
  AxumAPI-->>User: JSON(count)

  User->>AxumAPI: GET /trades?start_index=10&limit=50
  AxumAPI->>RedbWorker: GetTradesByRangeRequest
  RedbWorker-->>AxumAPI: Vec<Trade>
  AxumAPI-->>User: JSON(trades)
```

Storage schema diagram (ChatGPT):

```mermaid
erDiagram
  TRADE {
    u64 index PK
    json trade_data
  }
  TRADE_IDS {
    string trade_id PK
    u64 index
  }
  TRADES_META {
    string key PK
    u64 value
  }
```

# ðŸ§ª WebSocket-Based Real-Time Numerical Feeds for Stats & Visualization

## ðŸ“Œ Chat 1: Finding Real-Time Public Data Feeds

> *Goal:* Discover public WebSocket-based feeds suitable for live statistics (e.g., sliding windows, prices/volume analytics).

### ðŸ“ˆ Crypto Exchanges

Most crypto exchanges offer free WebSocket APIs:
- **Binance**
  - âœ… Trades, order books, candlesticks
  - ðŸ”— [Docs](https://binance-docs.github.io/apidocs/spot/en/#websocket-market-streams)
- **Coinbase**
  - âœ… Live trades, order books
  - ðŸ”— [Docs](https://docs.cloud.coinbase.com/exchange/docs/websocket-overview)
- **Kraken**
  - âœ… Trades, order books
  - ðŸ”— [Docs](https://docs.kraken.com/websockets/)
- **Bitfinex**
  - âœ… Trades, books, candles
  - ðŸ”— [Docs](https://docs.bitfinex.com/docs/ws-general)
- **Bybit**
  - âœ… Derivatives, perpetual contracts
  - ðŸ”— Docs available on their site

### ðŸ’² Stock Market (Limited Free Options)

- **Polygon.io**
  - âœ… Crypto: Free / Stocks: Paid
  - ðŸ”— [Docs](https://polygon.io/docs/crypto/get_v3_trades__cryptoticker__anchor)
- **IEX Cloud**
  - âœ… Free tier available for trades and quotes
  - ðŸ”— Docs on [iexcloud.io](https://iexcloud.io)

### ðŸŒ Other Real-Time Numerical Feeds

- **Met.no Weather API**
  - ðŸŒ§ Polling-based (simulate WebSocket)
- **OpenSky Network**
  - âœˆï¸ Real-time air traffic
  - ðŸ”— [Docs](https://openskynetwork.github.io/opensky-api/)

---

## ðŸ”¥ Best Feeds for Sliding Window Stats

> Ideal for real-time analytics like:
- Last 30-second moving average
- 5-minute traded volume
- Rolling price volatility

âœ… Crypto feeds are best due to:
- High frequency and volume
- WebSocket-first design
- Pair-specific subscription support

---

## âš¡ Quick-Start Examples

### ðŸ”¶ Binance Mini-Ticker

Stream of real-time price/volume updates for **all** pairs.

```bash
npx wscat -c wss://stream.binance.com:9443/ws/!miniTicker@arr
```

Message example:
```json
[
  {
    "e": "24hrMiniTicker",
    "s": "BNBBTC",
    "c": "0.0025",
    "v": "10000",
    "q": "18"
  }
]
```

### ðŸŸ¢ Coinbase BTC-USD Ticker

```bash
npx wscat -c wss://ws-feed.exchange.coinbase.com
```

Then paste:
```json
{
  "type": "subscribe",
  "channels": [{ "name": "ticker", "product_ids": ["BTC-USD"] }]
}
```

---

## ðŸ§ª One-liner Hack with `wscat`

```bash
(sleep 3; echo '{"type":"subscribe","channels":[{"name":"ticker","product_ids":["BTC-USD"]}]}'; sleep 10) | npx wscat -c wss://ws-feed.exchange.coinbase.com | tail -n +1 -f
```

âœ… Clean and useful for scripting + piping into analysis tools.

---

## ðŸ’» HTML5 + JavaScript WebSocket Viewer

### ðŸ“„ `btc-price.html`

```html
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>BTC-USD Price</title></head>
<body>
  <h1 id="price">Connecting...</h1>
  <script>
    const ws = new WebSocket("wss://ws-feed.exchange.coinbase.com");
    ws.addEventListener("open", () => {
      ws.send(JSON.stringify({
        type: "subscribe",
        channels: [{ name: "ticker", product_ids: ["BTC-USD"] }]
      }));
    });
    ws.addEventListener("message", (event) => {
      const data = JSON.parse(event.data);
      if (data.type === "ticker" && data.product_id === "BTC-USD") {
        document.getElementById("price").textContent = `$${data.price}`;
      }
    });
  </script>
</body>
</html>
```

---

## ðŸ“Š Clean HTML Table View (Kraken)

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>XBT/USD Trades</title>
  <style>
    body { font-family: sans-serif; background: #fafafa; padding: 20px; }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; background: white; font-size: 1.5em; }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: right; }
    th { background: #f0f0f0; }
    .buy { color: green; } .sell { color: red; }
  </style>
</head>
<body>
  <table>
    <thead><tr><th>Price</th><th>Volume</th><th>Total</th></tr></thead>
    <tbody id="trades"></tbody>
  </table>
  <script>
    const ws = new WebSocket("wss://ws.kraken.com/");
    ws.addEventListener("open", () => {
      ws.send(JSON.stringify({
        event: "subscribe",
        pair: ["XBT/USD"],
        subscription: { name: "trade" }
      }));
    });
    ws.addEventListener("message", (event) => {
      const data = JSON.parse(event.data);
      if (Array.isArray(data) && data[2] === "trade" && data[3] === "XBT/USD") {
        const latest = data[1].at(-1);
        const price = parseFloat(latest[0]);
        const volume = parseFloat(latest[1]);
        const side = latest[3];
        const total = (price * volume).toFixed(2);
        document.getElementById("trades").innerHTML = `
          <tr>
            <td class="${side === "b" ? "buy" : "sell"}">$${price.toFixed(2)}</td>
            <td>${volume.toFixed(6)}</td>
            <td>$${total}</td>
          </tr>`;
      }
    });
  </script>
</body>
</html>
```

---

## ðŸ§  Want More?

- âœ… Show 10â€“20 most recent trades?
- âœ… Add rolling stats overlay?
- âœ… Export CSVs or draw real-time charts?

Let me know and Iâ€™ll add a live chart or stat overlay next! ðŸŽ¯
